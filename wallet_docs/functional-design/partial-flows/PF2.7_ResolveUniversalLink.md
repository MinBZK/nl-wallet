# Partial Flow 2.7 Resolve a universal link

## Overview

| Aspect                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Summary**                  | The system validates universal link and determines next step for the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Goal**                     | Resolving a universal link invoked by the user.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Preconditions**            | *None*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Postconditions**           | *None*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Used by**                  | <ul><li>[UC1.2 Open the app](../use-cases/UC1.2_OpenTheApp.md)</li><li>[UC2.3 Unlock the app](../use-cases/UC2.3_UnlockTheApp.md)</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Parameters**               | *None*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Possible Results**         | <ul><li>No (valid) universal link</li><li>Wallet rejects universal link</li></ul><li>In case of a valid UL, the system continues with the corresponding use case</li>                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Additional Documentation** | *None*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Possible errors**          | *None*                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Logical test cases**       | <ul><li>[LTC33 Open app via universal link](../logical-test-cases.md#ltc33)</li><li>[LTC35 Invoke universal link when app is not installed](../logical-test-cases.md#ltc35)</li><li>[LTC36 Open universal link via external QR scanner](../logical-test-cases.md#ltc36)</li><li>[LTC44 Wallet not created when universal link is invoked](../logical-test-cases.md#ltc44)</li><li>[LTC55 Invalid universal link](../logical-test-cases.md#ltc55)</li><li>[LTC69 Universal link is invoked while wallet is not personalized](../logical-test-cases.md#ltc33)</li></ul> |

---

## Flow

| #       | Description                                                                                                                 | Next                                                                                             |
|---------|-----------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
| **1**   | **UNIVERSAL LINK**                                                                                                          |                                                                                                  |
| **1.1** | **System determines whether universal link is present**<ul><li>Provided by the operating system</li></ul>                   |                                                                                                  |
| 1.1a    | Case: universal link is present                                                                                             | 1.2                                                                                              |
| 1.1b    | Case: universal link is not present                                                                                         | Result: No (valid) universal link                                                                |
| **1.2** | **System validates universal link**<ul><li>Duration: 0.0 - 0.1 seconds</li></ul>                                            |                                                                                                  |
| 1.2a    | Case: universal link is valid                                                                                               |                                                                                                  |
| 1.2b    | Case: universal link is scanned with external QR scanner (not allowed)                                                      | 2                                                                                                |
| 1.2c    | Case: universal link is invalid                                                                                             | Result: No (valid) universal link                                                                |
| 1.2d    | Case: wallet is not personalized                                                                                            | 3                                                                                                |
| 1.2e    | Case: wallet is in a transfer session                                                                                       | 4                                                                                                |
| 1.2f    | Case: wallet is in a PIN recovery session                                                                                   | 5                                                                                                |
| 1.2g    | Case: wallet is in a disclosure session                                                                                     | 6                                                                                                |
| 1.2h    | Case: wallet is in an issuance session                                                                                      | 7                                                                                                |
| **1.3** | **System resolves universal link**<ul><li>Contacts the URL provided in the UL</li><li>Duration: 0.0 - 0.1 seconds</li></ul> |                                                                                                  |
| 1.3a    | Case: UL resolves to issuance flow                                                                                          | Go to: [UC4.1 Obtain cards](../use-cases/UC4.1_ObtainCardsFromEAAIssuer.md)                      |
| 1.3b    | Case: UL resolves to sharing flow                                                                                           | Go to: [UC5.1 Share data](../use-cases/UC5.1_ShareDataWithRP.md)                                 |
| 1.3c    | Case: UL resolves to login flow                                                                                             | Go to: [UC5.2 Log in to Relying Party application](../use-cases/UC5.2_LoginToApplicationOfRP.md) |
| **2**   | **WHEN EXTERNAL QR SCANNER WAS USED**                                                                                       |                                                                                                  |
| **2.1** | **System displays prompt 'Scan QR code with NL Wallet'**<ul><li>Actions: Close, Scan QR code</li></ul>                      |                                                                                                  |
| 2.1a    | User selects Close                                                                                                          | Result: No (valid) universal link                                                                |
| 2.1b    | User selects Scan QR code                                                                                                   | Go to: [UC9.9 Scan QR](../use-cases/UC9.9_ScanQR.md)                                             |
| **3**   | **WHEN WALLET IS NOT PERSONALIZED**                                                                                         |                                                                                                  |
| **3.1** | **System displays prompt 'Your NL Wallet is not ready'**<ul><li>Actions: OK</li></ul>                                       |                                                                                                  |
| 3.1a    | User selects OK                                                                                                             | Result: Wallet rejects universal link                                                            |
| **4**   | **WWHEN WALLET IS IN A TRANSFER SESSION**                                                                                   |                                                                                                  |
| **4.1** | **System displays prompt 'Finish moving your NL Wallet'**<ul><li>Actions: OK</li></ul>                                      |                                                                                                  |
| 4.1a    | User selects OK                                                                                                             | Result: Wallet rejects universal link                                                            |
| **5**   | **WWHEN WALLET IS IN A PIN RECOVERY SESSION**                                                                               |                                                                                                  |
| **5.1** | **System displays prompt 'Finish your new PIN'**<ul><li>Actions: OK</li></ul>                                               |                                                                                                  |
| 5.1a    | User selects OK                                                                                                             | Result: Wallet rejects universal link                                                            |
| **6**   | **WWHEN WALLET IS IN A DISCLOSURE SESSION**                                                                                 |                                                                                                  |
| **6.1** | **System displays prompt 'Finish sharing'**<ul><li>Actions: OK</li></ul>                                                    |                                                                                                  |
| 6.1a    | User selects OK                                                                                                             | Result: Wallet rejects universal link                                                            |
| **7**   | **WWHEN WALLET IS IN AN ISSUANCE SESSION**                                                                                  |                                                                                                  |
| **7.1** | **System displays prompt 'Finish adding your card'**<ul><li>Actions: OK</li></ul>                                           |                                                                                                  |
| 7.1a    | User selects OK                                                                                                             | Result: Wallet rejects universal link                                                            |
