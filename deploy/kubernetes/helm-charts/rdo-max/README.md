# RDO Max (DigiD Connector) helm-chart

This Helm chart deploys RDO Max, which serves as a DigiD Connector for the NL
Wallet project. RDO Max is a bridge between an OIDC client and a so-called TVS
(Toegang Verlenings Service). A TVS can be DigiD or any other IDP. RDO Max
allows an end-user to login into DigiD and provides the app with a token, which
can be used to retrieve the BSN of the end-user.

## Prerequisites

- Kubernetes
- Helm
- Redis (for session storage)
- A Kubernetes secret for TLS certificates (`tlsSecretName`)

## Get or refresh static source files

You can use the below commands to obtain a few static files we put in the
Kubernetes `configmap`. Note that the IdP metadata document might have
an auto-generated ID, which also means a different signature - this is
expected and does not affect operation.

```shell
# Get Staat der Nederlanden Private Root CA:
curl -s https://cert.pkioverheid.nl/PrivateRootCA-G1.cer |\
  openssl x509 -inform der -out 'static/PrivateRootCA-G1.pem'

# Get current IdP metadata XML:
curl -s 'https://was-preprod1.digid.nl/saml/idp/metadata' \
  -o 'static/saml-idp-metadata-digid-preprod.xml'

# Extract fingerprint from metadata XML:
xmllint --xpath \
  '//*[local-name()="KeyDescriptor"][@use="signing"]//*[local-name()="KeyName"]/text()' \
  'static/saml-idp-metadata-digid-preprod.xml' |\
  tr '[:lower:]' '[:upper:]' |\
  sed 's/.\{2\}/&:/g;s/:$//' >\
  'static/saml-idp-certificate-fingerprint.string'
```

## About the URN format you might encounter here and there

An example URN string `urn:nl-eid-gdi:1.0:LC:00000000000000000000:entities:0000`
follows the eID infrastructure naming convention:

  * `nl-eid-gdi:1.0`: Dutch eID GDI (Generieke Digitale Infrastructuur) version 1.0
  * `LC`: Login Controller (RDO Max's role)
  * `00000000000000000000`: Organization identifier (OIN, Organisatie Identificatienummer)
  * `entities:0000`: Entity number within that organization

This identifier must usually be unique and registered with the Identity
Provider (in this example case, DigiD/TVS) during the onboarding process. The
IdP uses it to identify which service provider is making the authentication
requests.

## Parameters

### Global parameters

| Name                   | Description                  | Value |
| ---------------------- | ---------------------------- | ----- |
| `global.imageRegistry` | Global Docker image registry | `""`  |

### Common parameters

| Name           | Description        | Value |
| -------------- | ------------------ | ----- |
| `replicaCount` | Number of replicas | `1`   |

### Image parameters

| Name               | Description                        | Value          |
| ------------------ | ---------------------------------- | -------------- |
| `image.repository` | Repository for the container image | `max`          |
| `image.pullPolicy` | Image pull policy                  | `IfNotPresent` |
| `image.tag`        | Image tag                          | `latest`       |

### Image pull secrets

| Name               | Description                                  | Value |
| ------------------ | -------------------------------------------- | ----- |
| `imagePullSecrets` | Array of secret names for private registries | `[]`  |

### Pod security context

| Name                 | Description                  | Value |
| -------------------- | ---------------------------- | ----- |
| `podSecurityContext` | Security context for the pod | `{}`  |

### Security context

| Name              | Description                        | Value |
| ----------------- | ---------------------------------- | ----- |
| `securityContext` | Security context for the container | `{}`  |

### Common parameters

| Name               | Description                                    | Value |
| ------------------ | ---------------------------------------------- | ----- |
| `fullnameOverride` | String to completely override chart's fullname | `""`  |
| `nameOverride`     | String to partially override chart's fullname  | `""`  |

### Annotations and labels

| Name               | Description                               | Value |
| ------------------ | ----------------------------------------- | ----- |
| `extraAnnotations` | Additional annotations for the deployment | `{}`  |
| `extraPodLabels`   | Additional labels for the pods            | `{}`  |

### Resource requests and limits

| Name                        | Description    | Value   |
| --------------------------- | -------------- | ------- |
| `resources.requests.cpu`    | CPU request    | `200m`  |
| `resources.requests.memory` | Memory request | `256Mi` |
| `resources.limits.cpu`      | CPU limit      | `1000m` |
| `resources.limits.memory`   | Memory limit   | `512Mi` |

### Max server configuration

| Name                                                       | Description                                                                                                                                                                                                                                                                                                                                                                                       | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ---------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `max.home`                                                 | The location within the container image where the RDO Max application resides. Usually /app, /max or /src                                                                                                                                                                                                                                                                                         | `/max`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.app.environment`                               | Possible values are: development, production                                                                                                                                                                                                                                                                                                                                                      | `development`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `max.config.app.userInfoService`                           | Possible userinfo providing services are: cc, cibg, eherkenning                                                                                                                                                                                                                                                                                                                                   | `cc`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.app.externalBaseUrl`                           | External url for RDO Max without trailing slash                                                                                                                                                                                                                                                                                                                                                   | `https://localhost:8006`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.app.sessionUrl`                                | Used by the ExternalSessionService to communicate with an external session server                                                                                                                                                                                                                                                                                                                 | `https://localhost:8006/session`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `max.config.app.mockedUziDataFilePath`                     | Used to provide fake UZI data during development when using DigiD Mock                                                                                                                                                                                                                                                                                                                            | `none`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.app.logLevel`                                  | Possible values are: debug, info, warning, error, critical                                                                                                                                                                                                                                                                                                                                        | `debug`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.app.loginMethodsFilePath`                      | Where to find login_methods.json, which defines available authentication methods                                                                                                                                                                                                                                                                                                                  | `login_methods.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.app.jsonSchemaPath`                            | Where to find json_schema.json, describes the structure of userinfo responses                                                                                                                                                                                                                                                                                                                     | `config/json_schema.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.app.redirectType`                              | Possible values are http, html. Use HTTP-based, or HTML-based redirects                                                                                                                                                                                                                                                                                                                           | `http`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.app.userAuthenticationSymKey`                  | NaCl Symmetric encryption key used for encrypting the authentication cache                                                                                                                                                                                                                                                                                                                        | `0000000000000000000000000000000000000000000000000000000000000000`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `max.config.app.externalHttpRequestsTimeoutSeconds`        | How long to wait for external HTTP requests to finish                                                                                                                                                                                                                                                                                                                                             | `15`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.app.versionFilePath`                           | Where to find the file with version information                                                                                                                                                                                                                                                                                                                                                   | `static/version.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `max.config.app.languagePath`                              | Path to the translation file of the configured language                                                                                                                                                                                                                                                                                                                                           | `lang/nl.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `max.config.app.includeLogMessageInErrorResponse`          | When True, the internal log message (detailed technical error info) is appended to the user-facing error_description. When False, only the generic error description is shown                                                                                                                                                                                                                     | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.jwe.signingCertificatePath`                    | The certificate used for signing, included in the token so recipients can verify the signature, i.e., for creating JSON Web Encryption tokens                                                                                                                                                                                                                                                     | `secrets/userinfo/jwe_sign.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.config.jwe.signingPrivateKeyPath`                     | The private key used for signing, for creating JSON Web Encryption tokens                                                                                                                                                                                                                                                                                                                         | `secrets/userinfo/jwe_sign.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.config.jwt.sessionIssuer`                             | The iss claim in the JSON Web Token, identifies the token creator                                                                                                                                                                                                                                                                                                                                 | `nl-rdo-max`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.jwt.sessionAudience`                           | The aud claim in the JSON Web Token, identifies the intended recipient                                                                                                                                                                                                                                                                                                                            | `nl-uzi-login-controller`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.jwt.sessionSigningCertificatePath`             | Certificate included in the JSON Web Token, so the session server can verify the signature                                                                                                                                                                                                                                                                                                        | `secrets/userinfo/jwe_sign.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.config.jwt.sessionSigningPrivateKeyPath`              | Private key used to sign the JSON Web Token                                                                                                                                                                                                                                                                                                                                                       | `secrets/userinfo/jwe_sign.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.config.asgi.host`                                     | The hostname or IP address RDO Max listens on                                                                                                                                                                                                                                                                                                                                                     | `0.0.0.0`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.asgi.port`                                     | The TCP port RDO Max listens on                                                                                                                                                                                                                                                                                                                                                                   | `8006`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.asgi.reload`                                   | When True, RDO Max watches for file changes and automatically restarts the server when code is modified, ignores workers and always runs with a single process                                                                                                                                                                                                                                    | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.asgi.reloadIncludes`                           | Lets you specify explicitly which file patterns to watch for changes. If unset, defaults to *.py                                                                                                                                                                                                                                                                                                  | `*.conf`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.asgi.workers`                                  | Controls the number of worker processes to spawn, where each worker is a separate OS process handling requests independently                                                                                                                                                                                                                                                                      | `1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `max.config.asgi.useSsl`                                   | Enable SSL/TLS for RDO Max, could be disabled if serving through an ingress or gateway on Kubernetes                                                                                                                                                                                                                                                                                              | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.asgi.sslBaseDirectory`                         | Base directory where SSL/TLS certificates are stored                                                                                                                                                                                                                                                                                                                                              | `secrets/ssl`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `max.config.asgi.sslServerCertificateFile`                 | The certificate file, in PEM format, for RDO Max                                                                                                                                                                                                                                                                                                                                                  | `server.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.asgi.sslServerPrivateKeyFile`                  | The private key file, in PEM format, for RDO Max                                                                                                                                                                                                                                                                                                                                                  | `server.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.oidc.certificatesDirectory`                    | Points to a directory containing .crt files that get loaded and added to the JWKS endpoint, which allows clients obtain these certificates, to verify tokens signed by RDO Max                                                                                                                                                                                                                    | `secrets/oidc/jwks-certs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.oidc.rsaCertificatePath`                       | RSA Certificate used to derive the key ID (kid)                                                                                                                                                                                                                                                                                                                                                   | `secrets/oidc/selfsigned.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `max.config.oidc.rsaPrivateKeyPath`                        | Private RSA key used to sign OIDC tokens (ID tokens, access tokens)                                                                                                                                                                                                                                                                                                                               | `secrets/oidc/selfsigned.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `max.config.oidc.issuerUrl`                                | The canonical URL that identifies RDO Max as an OIDC provider                                                                                                                                                                                                                                                                                                                                     | `https://localhost:8006`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.oidc.authorizeEndPoint`                        | Authorize endpoint, usually /authorize                                                                                                                                                                                                                                                                                                                                                            | `/authorize`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.oidc.jwksEndpoint`                             | JWKS endpoint, usually /jwks                                                                                                                                                                                                                                                                                                                                                                      | `/jwks`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.oidc.accessTokenEndPoint`                      | Access token endpoint, usually /token                                                                                                                                                                                                                                                                                                                                                             | `/token`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.oidc.userInfoEndPoint`                         | Userinfo endpoint, usually /userinfo                                                                                                                                                                                                                                                                                                                                                              | `/userinfo`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.oidc.scopesSupported`                          | Can be openid and/or authorization_by_proxy, can be a string list separated by comma. The authorization_by_proxy setting enables "machtiging", where one entity acts on behalf of another. Appears in the /.well-known/openid-configuration response, letting clients know which scopes are available                                                                                             | `openid`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.oidc.clientsFile`                              | Indicates where to find the clients.json file. Clients are the applications (relying parties) that use Max as their OIDC identity provider. Think of them as "allowed apps" that can redirect users to RDO Max for authentication                                                                                                                                                                 | `clients.json`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `max.config.oidc.subjectIdHashSalt`                        | Makes the hash unpredictable. Used to generate pairwise subject identifiers, which are unique user IDs that differ per client                                                                                                                                                                                                                                                                     | `somesalt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `max.config.oidc.jwtExpirationDuration`                    | Sets the expiration time (in seconds) for JWT/JWE tokens that RDO Max issues                                                                                                                                                                                                                                                                                                                      | `60`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.oidc.jwtNbfLag`                                | Sets the nbf (not before) claim, a small window to account for clock skew between servers                                                                                                                                                                                                                                                                                                         | `10`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.oidc.allowWildcardRedirectUri`                 | When True, a client can have `"redirect_uris": ["*"]`, and any redirect URI will be accepted. Only works when environment is not production                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.oidc.client.loginRedirectUrl`                  | Where to redirect to when login is required. Usually /login/oidc/start                                                                                                                                                                                                                                                                                                                            | `http://localhost:8001/login/oidc/start`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.saml.identityProvidersBasePath`                | The base path where IdP's are defined                                                                                                                                                                                                                                                                                                                                                             | `saml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.saml.xmlTemplatesPath`                         | Where to find XML templates                                                                                                                                                                                                                                                                                                                                                                       | `saml/templates/xml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.saml.htmlTemplatesPath`                        | Where to find HTML templates                                                                                                                                                                                                                                                                                                                                                                      | `saml/templates/html`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `max.config.saml.baseIssuer`                               | The base issuer address, usually in the hostname:port format                                                                                                                                                                                                                                                                                                                                      | `localhost:8007`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `max.config.saml.verifierCa`                               | Can be true (uses system default CA bundle), false, which disables SSL verification in Python's requests library, and a path to either a CA certificate or a directory with CA certificates                                                                                                                                                                                                       | `saml/digid/PrivateRootCA-G1.pem`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `max.config.saml.idp.entityId`                             | The IdP entity ID. Could also come from the entityID attribute in the XML IdP metadata, specified by metadata_path                                                                                                                                                                                                                                                                                | `idp_entity_id`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.config.saml.idp.metaDataPath`                         | Where to find the IdP metadata XML. Can be an URL also, but there is no special handling for timeouts, retries, or custom settings for SSL verification; if the URL is slow or unreachable, the application might block or fail                                                                                                                                                                   | `saml/digid/metadata/idp_metadata.xml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.saml.idp.ssoUrl`                               | The Single Sign-On Service URL is the IdP's endpoint where RDO Max sends users to authenticate                                                                                                                                                                                                                                                                                                    | `https://preprod1.digid.nl/saml/idp/request_authentication`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.saml.idp.ssoBinding`                           | Determines how RDO Max redirects users, usually some SAML namespace prefix followed by HTTP-POST or HTTP-Redirect                                                                                                                                                                                                                                                                                 | `urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.saml.sp.certificatePath`                       | When resolving artifacts, this certificate (and the private key below) are used for mutual TLS to the IdP. The certificate is also included in SP metadata so the IdP knows how to verify RDO Max's signatures and encrypt data for RDO Max. The IdP must trust this certificate/key pair                                                                                                         | `saml/digid/certs/sp.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.saml.sp.privateKeyPath`                        | AuthnRequests and ArtifactResolve requests are signed with this private key. The private key also decrypts encrypted SAML assertions from the IdP. The IdP must trust this certificate/key pair                                                                                                                                                                                                   | `saml/digid/certs/sp.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| `max.config.saml.sp.entityId`                              | RDO Max's unique identifier as a SAML Service Provider. Used in outgoing SAML requests (AuthnRequest). Also for validating incoming responses, where it matches the audience in the response matches the entityId. Also used in SP metadata                                                                                                                                                       | `https://localhost:8006`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.saml.sp.nameIdFormat`                          | Specifies how the user identifier (NameID) in responses should be formatted. Usually has some SAML namespace prefix followed by unspecified, transient, persistent or emailAddress                                                                                                                                                                                                                | `urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.saml.sp.acsUrl`                                | The endpoint where Max receives SAML responses from the Identity Provider, i.e., the Assertion Consumer Service (ACS) URL                                                                                                                                                                                                                                                                         | `https://localhost:8006/acs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.saml.sp.acsBinding`                            | The SAML protocol binding, i.e., how the response is delivered, Usually some SAML namespace prefix followed by HTTP-Artifact, HTTP-POST or HTTP-Redirect                                                                                                                                                                                                                                          | `urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.saml.sp.serviceName`                           | Name of the service provider                                                                                                                                                                                                                                                                                                                                                                      | `NL Wallet`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.saml.sp.serviceDescription`                    | Description of the service provider                                                                                                                                                                                                                                                                                                                                                               | `NL Wallet Login`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `max.config.saml.sp.requestedAttributes[0].name`           | Usually urn:nl-eid-gdi:1.0:ServiceUUID                                                                                                                                                                                                                                                                                                                                                            | `urn:nl-eid-gdi:1.0:ServiceUUID`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `max.config.saml.sp.requestedAttributes[0].nameFormat`     | Optional SAML name format indicator for the attribute                                                                                                                                                                                                                                                                                                                                             | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.saml.sp.requestedAttributes[0].friendlyName`   | Optional SAML friendly name of the attribute                                                                                                                                                                                                                                                                                                                                                      | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.saml.sp.requestedAttributes[0].isRequired`     | Signifies this attribute is required in the response                                                                                                                                                                                                                                                                                                                                              | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.saml.sp.requestedAttributes[0].attributeValue` | When you register Max as a service with DigiD/TVS, you receive a ServiceUUID that uniquely identifies your service. That should be this value                                                                                                                                                                                                                                                     | `["384a7c30-97b2-41e1-899f-3949c2542ae8"]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `max.config.saml.metaData.organization.en-US.name`         | US English name of the organization                                                                                                                                                                                                                                                                                                                                                               | `NL Wallet`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.saml.metaData.organization.en-US.displayName`  | US English friendly display name of the organization                                                                                                                                                                                                                                                                                                                                              | `NL Wallet`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.saml.metaData.organization.en-US.url`          | US English URL of the organization                                                                                                                                                                                                                                                                                                                                                                | `https://github.com/minbzk/nl-wallet`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `max.config.saml.metaData.contact.technical.givenName`     | Name of the technical contact                                                                                                                                                                                                                                                                                                                                                                     | `Nobody`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.config.saml.metaData.contact.technical.emailAddress`  | E-mail address of the technical contact                                                                                                                                                                                                                                                                                                                                                           | `nobody@example.com`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.redis.host`                                    | The hostname or IP address of the Redis server                                                                                                                                                                                                                                                                                                                                                    | `redis`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.redis.port`                                    | The TCP port of the Redis server                                                                                                                                                                                                                                                                                                                                                                  | `6379`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `max.config.redis.enableDebugger`                          | Starts a background thread that monitors Redis key expiration to detect unused cached values. Tracks retrieved values by storing a copy under a retrieved: prefixed key (with a longer TTL). Listens for expiration events, by subscribing to Redis keyspace notifications. Detects unretrieved values. When a key expires, it checks if the retrieved: copy exists. If not, logs a debug message | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.redis.useSsl`                                  | Enable SSL/TLS client configuration for interacting with Redis                                                                                                                                                                                                                                                                                                                                    | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `max.config.redis.sslClientCertificateFile`                | Client certificate to use when connecting to Redis                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.redis.sslClientPrivateKeyFile`                 | Client private key to use when connecting to Redis                                                                                                                                                                                                                                                                                                                                                | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.redis.sslCaCertificateFile`                    | CA certificate to use when validating Redis server authenticity                                                                                                                                                                                                                                                                                                                                   | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| `max.config.redis.objectTtl`                               | Sefines how long (in seconds) data lives in Redis before it expires. The default is 600                                                                                                                                                                                                                                                                                                           | `600`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `max.config.redis.defaultCacheNameSpace`                   | Default prefix for the cache namespace                                                                                                                                                                                                                                                                                                                                                            | `max`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `max.config.redis.tokenNameSpace`                          | Default prefix for the token namespace                                                                                                                                                                                                                                                                                                                                                            | `tvs_token`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `max.config.redis.refreshTokenNameSpace`                   | Default prefix for the refresh token namespace                                                                                                                                                                                                                                                                                                                                                    | `tvs_refresh_token`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `max.config.redis.subjectIdentifierNameSpace`              | Default prefix for the subject identifier namespace                                                                                                                                                                                                                                                                                                                                               | `tvs_sub_id`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `max.config.redis.codeNameSpace`                           | Default prefix for the code namespace                                                                                                                                                                                                                                                                                                                                                             | `tvs_auth_code`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `max.extraConfigFiles.clients.json`                        | Default clients.json configuration file                                                                                                                                                                                                                                                                                                                                                           | `{
  "3e58016e-bc2e-40d5-b4b1-a3e25f6193b9": {
    "name": "NL Wallet",
    "external_id": "87654321",
    "external_ids": ["87654321"],
    "token_endpoint_auth_method": "none",
    "redirect_uris": [
      "walletdebuginteraction://wallet.edi.rijksoverheid.nl/return-from-digid/",
      "walletdebuginteraction://wallet.edi.rijksoverheid.nl/return-from-digid"
    ],
    "error_page": "walletdebuginteraction://wallet.edi.rijksoverheid.nl/return-from-digid",
    "response_types": ["code"],
    "pubkey_type": "RSA",
    "client_authentication_method": "none",
    "client_certificate_path": "secrets/clients/test_client/test_client.crt"
  }
}` |
| `max.extraConfigFiles.login_methods.json`                  | Default login_methods.json configuration file                                                                                                                                                                                                                                                                                                                                                     | `[
  {
    "name": "digid_mock",
    "logo": "static/img/digid-logo.svg",
    "text": "Inloggen met DigiD mock",
    "type": "specific"
  }
]`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `max.secret.certificateName`                               | Name of the certificate within the secret                                                                                                                                                                                                                                                                                                                                                         | `sp.crt`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.secret.privateKeyName`                                | Name of the private key within the secret                                                                                                                                                                                                                                                                                                                                                         | `sp.key`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| `max.secret.secretName`                                    | Name of the secret in Kubernetes                                                                                                                                                                                                                                                                                                                                                                  | `max-app-secret`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |

### Ingress parameters

| Name                    | Description                            | Value   |
| ----------------------- | -------------------------------------- | ------- |
| `ingress.enabled`       | Enable or disable the ingress          | `true`  |
| `ingress.className`     | Ingress class name                     | `nginx` |
| `ingress.hostName`      | Hostname for the ingress               | `nil`   |
| `ingress.contextPath`   | Optional context path for the ingress  | `nil`   |
| `ingress.tlsSecretName` | Name of the TLS secret for the ingress | `nil`   |
| `ingress.labels`        | Additional labels for the ingress      | `{}`    |
| `ingress.annotations`   | Additional annotations for the ingress | `{}`    |
