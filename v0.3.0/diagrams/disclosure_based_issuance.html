

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Disclosure based issuance &mdash; NL Wallet 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=675a712c" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
      <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
      <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
      <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
      <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Issuance with OpenID4VCI" href="issuance.html" />
    <link rel="prev" title="Disclosure with OpenID4VP" href="disclosure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #383EDE" >

          
          
          <a href="../index.html" class="icon icon-home">
            NL Wallet
              <img src="../_static/wallet.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../relying-party.html">Relying Party</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#step-by-step">Step-by-step</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#preparations-and-onboarding">Preparations and Onboarding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#decisions">Decisions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#what-a-pid-doctype-looks-like">What a PID_DOCTYPE looks like</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#what-an-address-doctype-looks-like">What an ADDRESS_DOCTYPE looks like</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#required-data">Required Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#example-reader-auth-json">Example reader_auth.json</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#example-screenshot-of-reader-auth-json-data-used-in-wallet-app">Example Screenshot of reader_auth.json Data Used in Wallet App</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#certificate-request">Certificate Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#file-request">File Request</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#wallet-server-installation">Wallet server installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#obtaining-the-software">Obtaining the software</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#creating-a-database-backend-optional">Creating a database backend (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#create-a-database-server">Create a database server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#create-user-and-database-itself">Create user and database itself:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#apply-database-schema">Apply database schema:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#creating-a-configuration">Creating a configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../relying-party.html#the-storage-settings">The storage settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../relying-party.html#using-in-memory-session-state">Using in-memory session state</a></li>
<li class="toctree-l4"><a class="reference internal" href="../relying-party.html#using-database-persisted-session-state-optional">Using database persisted session state (optional)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#determine-public-url">Determine public URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#universal-link-base-url">Universal link base URL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#the-ephemeral-id-secret">The ephemeral ID secret</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#configuring-the-trustanchor-and-the-usecase">Configuring the trustanchor and the usecase</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#creating-the-configuration-file">Creating the configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#configuring-an-api-key-optional">Configuring an API key (optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#configuring-cross-origin-resource-sharing-optional">Configuring Cross-Origin Resource Sharing (optional)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#running-the-server-for-the-first-time">Running the server for the first time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#server-logging">Server logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#validating-the-configuration">Validating the configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#background">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#what-a-disclosure-session-looks-like">What a Disclosure Session Looks Like</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#cross-device-vs-same-device">Cross Device vs. Same Device</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#notes-on-requirements-applicable-to-your-application">Notes on Requirements Applicable to Your Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#integration">Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#api-specifications">API Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#example-calls">Example calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#initiate-a-disclosure-session">Initiate a Disclosure Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#check-status-of-session">Check Status of Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relying-party.html#retrieve-disclosure-results">Retrieve Disclosure Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../relying-party.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../spec-references.html">Specification references</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec-references.html#protocols">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec-references.html#attestation-formats">Attestation formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec-references.html#cryptography">Cryptography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec-references.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html">Generic issuance in NL Wallet ecosystem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#sd-jwt">SD-JWT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#mdoc">mdoc</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#serialize-the-mdoc-to-json-for-json-schema">1. Serialize the mdoc to JSON for JSON Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#convert-namespace-structure-to-nested-sd-jwt-structure">2. Convert namespace structure to nested SD-JWT structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#example">Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#sd-jwt-vc-type-metadata-used-for-validation">SD-JWT VC Type Metadata used for validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#mdoc-formatted-document-snippet">Mdoc formatted document snippet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../generic_issuance/technical_attestation_schema.html#transformed-snippet-used-for-validation-against-type-metadata">Transformed snippet used for validation against Type Metadata</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html">SD-JWT VC Profile for the NL Wallet, VV and OV</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#sd-jwt-vc-type-metadata">SD-JWT VC Type Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#type-metadata">Type Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#display-metadata">Display Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#credential-summary">Credential Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#simple-rendering">Simple Rendering</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#claims-metadata">Claims Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#claim-metadata">Claim Metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#claim-display-metadata">Claim Display Metadata</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#extending-types">Extending types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#profile-considerations">Profile considerations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#c1-credential-contents-must-be-presentable-to-the-end-user">C1 - Credential contents must be presentable to the end user</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#c2-credential-summary-based-on-contents-for-optimized-browsing">C2 - Credential summary (based on contents) for optimized browsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#c3-no-support-for-external-resources">C3 - No support for external resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#c4-unambiguously-select-a-locale-for-displaying-credentials">C4 - Unambiguously select a locale for displaying credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spec-profiles/sd-jwt-vc.html#c5-allow-attributes-to-be-selectively-disclosable-by-default">C5 - Allow attributes to be selectively disclosable by default</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/README.html">Open Api Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="app_startup.html">App Startup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="app_startup.html#initialization">Initialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="app_startup.html#extra-callbacks">Extra callbacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="app_startup.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_startup.html#wallet-lock">Wallet lock</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="disclosure.html">Disclosure with OpenID4VP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="disclosure.html#generic-disclosure">Generic disclosure</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Disclosure based issuance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#attestation-server">Attestation server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#issuance-server-configuration"><code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#qr-ul">QR/UL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sequence-diagram">Sequence diagram</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="issuance.html">Issuance with OpenID4VCI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="issuance.html#pid-issuance">PID issuance</a></li>
<li class="toctree-l2"><a class="reference internal" href="issuance.html#generic-issuance">Generic issuance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="overview_components.html">Components overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="pin_validation.html">Pin validation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pin_validation.html#local-pin-validation">Local pin validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="pin_validation.html#remote-pin-validation">Remote pin validation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="wallet_creation.html">Wallet creation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="wallet_creation.html#create-wallet-app">Create wallet (app)</a></li>
<li class="toctree-l2"><a class="reference internal" href="wallet_creation.html#create-wallet-server">Create wallet (server)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lokalise.html">Lokalise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lokalise.html#workflow">Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../lokalise.html#exporting-translations-lokalise-app">Exporting translations (lokalise -&gt; app)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../lokalise.html#export-script">Export script</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../lokalise.html#importing-keys-translations-app-lokalise">Importing keys/translations (app -&gt; lokalise)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../lokalise.html#import-script">Import script</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chores/update-rust.html">How to update Rust (or anything really) for NL Wallet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../chores/update-rust.html#update-rust-images">Update Rust images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chores/update-rust.html#update-rust-macos-runner">Update Rust macOS Runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chores/update-rust.html#update-rust-workspace-version">Update Rust workspace version</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wow/definition-of-done.html">Definition of done</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../wow/definition-of-done.html#in-general">In general</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wow/definition-of-done.html#things-we-check-every-pull-or-merge-request">Things we check every pull- or merge request</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#is-in-compliance-with-our-coding-and-quality-standards">Is in compliance with our coding and quality standards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#implements-and-tests-all-acceptance-criteria-and-or-capabilities">Implements and tests all acceptance criteria and/or capabilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#implements-any-screens-according-to-our-figma-designs-if-applicable">Implements any screens according to our Figma designs (if applicable)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#is-described-in-release-notes-with-any-breaking-changes-or-upgrade-steps">Is described in release notes, with any breaking changes or upgrade steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#is-documented-in-readme-md-files-openapi-specs-documentation-folder">Is documented (in README.md files, OpenAPI specs, documentation folder)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#does-not-contain-commits-with-personal-secret-or-copyrighted-information">Does not contain commits with personal, secret or copyrighted information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#incurred-technical-debt-has-a-todo-comment-and-a-related-issue-ticket">Incurred technical debt has a TODO comment and a related issue ticket</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/definition-of-done.html#can-be-deployed-locally-and-remotely-ci-cd-related-setup-up-to-date">Can be deployed locally and remotely (CI/CD related setup up-to-date)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../wow/merge-requests.html">Merge Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wow/release-howto.html">Releases Howto</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../wow/release-howto.html#assumptions">Assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wow/release-howto.html#what-constitutes-a-release">What constitutes a release?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wow/release-howto.html#doing-a-release">Doing a release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-1-make-sure-the-release-on-jira-is-green">Step 1: Make sure the release on Jira is green</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-2-make-sure-figma-links-are-up-to-date-in-readme-md">Step 2: Make sure Figma links are up-to-date in README.md</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-3-confirm-appropiate-tests-and-reports-have-been-done-for-this-release">Step 3: Confirm appropiate tests and reports have been done for this release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-4-release-approval">Step 4: Release approval</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-5-freeze-git-main-branch">Step 5: Freeze git main branch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-6-set-release-version-and-tag">Step 6: Set release version and tag</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-7-set-development-version">Step 7: Set development version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-8-collect-build-artifacts-for-release">Step 8: Collect build artifacts for release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-9-create-a-release-description">Step 9: Create a release description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wow/release-howto.html#step-10-create-github-release-from-tag">Step 10: Create GitHub release from tag</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wow/release-howto.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../templates/release-notes.html">Release Notes Template</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../templates/release-notes.html#vx-y-z-fill-in-version-place-at-documentation-release-notes-vx-y-z-md">vX.Y.Z (fill in version, place at /documentation/release-notes/vX.Y.Z.md)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../templates/release-notes.html#important-this-is-an-optional-header-remove-if-there-are-no">Important (this is an optional header, remove if there are no )</a></li>
<li class="toctree-l3"><a class="reference internal" href="../templates/release-notes.html#changes">Changes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/releases.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../release-notes/v0.3.0.html">Release notes v0.3.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#upgrading">Upgrading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#new-features">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#code-improvements">Code improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#wallet-app-improvements">Wallet app improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#bug-fixes">Bug fixes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release-notes/v0.3.0.html#ci-changes">CI changes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #383EDE" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NL Wallet</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Disclosure based issuance</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/diagrams/disclosure_based_issuance.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="disclosure-based-issuance">
<h1>Disclosure based issuance<a class="headerlink" href="#disclosure-based-issuance" title="Link to this heading"></a></h1>
<p>Disclosure based issuance allows an attestation issuer to issue attestations to a wallet based on the contents of attributes disclosed by that same wallet.</p>
<p>The flow starts when the user scans a QR code, or taps on a UL, that starts the disclosure based issuance flow.
The wallet then presents a disclosure screen to the user, which upon user consent is followed immediately by an issuance screen presenting the new attestations.
In between the two screens, the issuer receives the disclosed attributes, and can use those to determine the contents of the attestation(s) to be issued.</p>
<p>The issuer side of this functionality is implemented by the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> binary under <code class="docutils literal notranslate"><span class="pre">wallet_core/wallet_server</span></code>.</p>
<p>Technically, disclosure based issuance is achieved as follows:</p>
<ol class="arabic simple">
<li><p>At the end of the disclosure session, the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> sends the disclosed attributes to a preconfigured HTTP endpoint, at which the issuer must run an HTTP server that must respond with the attestations to be issued. This server is called the <em>attestation server</em>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> starts an OpenID4VCI session in the <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0-13.html#name-pre-authorized-code-flow">Pre-Authorized Code Flow</a>, puts the Pre-Authorized Code into an <a class="reference external" href="https://openid.net/specs/openid-4-verifiable-credential-issuance-1_0-13.html#name-credential-offer">OpenID4VCI Credential Offer</a>, and URL-encodes that into the <code class="docutils literal notranslate"><span class="pre">redirect_uri</span></code> that gets sent to the wallet.</p></li>
<li><p>Using the Credential Offer with the Pre-Authorized Code within it, the wallet performs the OpenID4VCI session with the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code>.</p></li>
</ol>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Link to this heading"></a></h2>
<section id="attestation-server">
<h3>Attestation server<a class="headerlink" href="#attestation-server" title="Link to this heading"></a></h3>
<p>The attestation server exchanges disclosed attributes for attestations to be issued. It is contacted by the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> during a disclosure based issuance session to do this. Note that this server does not need to be reachable by the wallet, and it probably should not be directly connected to the internet.</p>
<p>The attestation server receives an HTTP <code class="docutils literal notranslate"><span class="pre">POST</span></code> by the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> containing a JSON structure of the same form as the <code class="docutils literal notranslate"><span class="pre">/disclosed_attributes</span></code> endpoint of the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> returns, as documented in the <a class="reference internal" href="../relying-party.html#retrieve-disclosure-results"><span class="std std-ref">Relying Party documentation</span></a>. More specifically, this is a JSON-serialized <code class="docutils literal notranslate"><span class="pre">IndexMap&lt;String,</span> <span class="pre">DocumentDisclosedAttributes&gt;</span></code>. For example:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="nf">POST</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:51560</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">267</span>

<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;com.example.pid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;com.example.pid&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;bsn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;999991772&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;issuerUri&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://cert.issuer.example.com/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ca&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ca.pid.example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;validityInfo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;signed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-04-15T07:02:26Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;validFrom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-04-15T07:02:26Z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;validUntil&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2026-04-15T07:02:26Z&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">attestation_server</span></code> must respond with a JSON-serialized <code class="docutils literal notranslate"><span class="pre">Vec&lt;IssuableDocument&gt;</span></code>. For example:</p>
<div class="highlight-http notranslate"><div class="highlight"><pre><span></span><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>

<span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;attestation_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;com.example.degree&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;university&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Example university&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;education&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Example education&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;graduation_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1970-01-01&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;grade&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;cum_laude&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The JSON array may be empty (i.e. <code class="docutils literal notranslate"><span class="pre">[]</span></code>) to indicate that no attestations to be issued were found. In that case, the wallet will present a screen to the user explaining that there were no attestations found that can be issued.</p>
</section>
<section id="issuance-server-configuration">
<h3><code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> configuration<a class="headerlink" href="#issuance-server-configuration" title="Link to this heading"></a></h3>
<p>For each attestation server, a configuration block like the following must be put in the configuration file of the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code>.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[disclosure_settings.degree]</span>
<span class="c1"># Either &quot;hsm&quot; or &quot;software&quot;</span>
<span class="n">private_key_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hsm&quot;</span>

<span class="c1"># In case of &quot;hsm&quot;: label for the private key in the HSM</span>
<span class="c1"># In case of &quot;software&quot;: a DER-serialized private key</span>
<span class="n">private_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;my_issuer_key&quot;</span>

<span class="c1"># RP certificate</span>
<span class="n">certificate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIJ...&quot;</span>

<span class="k">[disclosure_settings.degree.attestation_url_config]</span>
<span class="c1"># URL to the attestation server</span>
<span class="n">base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://attestation_server.example.com&quot;</span>
<span class="n">trust_anchors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;MIJ...&quot;</span><span class="p">]</span>

<span class="c1"># Attributes that have to be disclosed for `degree`</span>
<span class="k">[[disclosure_settings.degree.to_disclose]]</span>
<span class="n">docType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;com.example.pid&quot;</span>
<span class="n">nameSpaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;com.example.pid&quot;</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">bsn</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>

<span class="c1"># A block like this has to be present for each attestation type that gets issued</span>
<span class="k">[attestation_settings.</span><span class="s2">&quot;com.example.degree&quot;</span><span class="k">]</span>
<span class="n">valid_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">365</span>
<span class="n">copy_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">private_key_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;software&quot;</span><span class="w"> </span><span class="c1"># or &quot;hsm&quot;, see above</span>
<span class="n">private_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIG...&quot;</span><span class="w">        </span><span class="c1"># DER-encoded private key, in case of &quot;software&quot;</span>
<span class="n">certificate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIJ...&quot;</span><span class="w">        </span><span class="c1"># Issuer certificate</span>

<span class="c1"># Files containing SD-JWT Type Metadata documents for each attestation that will be issued</span>
<span class="n">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;com.example.degree.json&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">degree</span></code> is an example of a freely choosable identifier that has to be present in the QR/UL that starts the session.</p>
<p>For the rest of the configuration parameters of the <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code>, see the <a class="reference download internal" download="" href="../_downloads/cfd0fc70893e7a8e15b716697ef14c54/issuance_server.example.toml"><span class="xref download myst"><code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> example configuration file</span></a> and the <a class="reference internal" href="../relying-party.html#retrieve-disclosure-results"><span class="std std-ref">Relying Party documentation</span></a>.</p>
</section>
<section id="qr-ul">
<h3>QR/UL<a class="headerlink" href="#qr-ul" title="Link to this heading"></a></h3>
<p>The wallet starts disclosure based issuance if it encounters a UL (or a QR with a UL within it) of a specific format. To create this UL, proceed as follows.</p>
<ol class="arabic">
<li><p>If your <code class="docutils literal notranslate"><span class="pre">issuance_server</span></code> is reachable on the internet by the wallet at <code class="docutils literal notranslate"><span class="pre">https://issuer.example.com</span></code>, create a URL of the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://issuer.example.com/disclosure/degree/request_uri?session_type=same_device
</pre></div>
</div>
<p>In which <code class="docutils literal notranslate"><span class="pre">degree</span></code> has to be the identifier mentioned above.</p>
</li>
<li><p>URL-encode the above URL.</p></li>
<li><p>Create the UL as follows (newlines only for readability purposes):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://app.test.voorbeeldwallet.nl/deeplink/disclosure_based_issuance
  ?request_uri_method=post
  &amp;client_id=disclosure_based_issuance.example.com
  &amp;request_uri=https%3A%2F%2Fissuer.example.com...
</pre></div>
</div>
<p>In which the <code class="docutils literal notranslate"><span class="pre">client_id</span></code> has to be the SAN DNS name from the RP <code class="docutils literal notranslate"><span class="pre">certificate</span></code>, and the <code class="docutils literal notranslate"><span class="pre">request_uri</span></code> is the URL-encoded URL from the previous step.</p>
</li>
</ol>
<p>Next, place this UL on your website (within in a QR code in case of cross device flows).</p>
</section>
</section>
<section id="sequence-diagram">
<h2>Sequence diagram<a class="headerlink" href="#sequence-diagram" title="Link to this heading"></a></h2>
<p>This diagram shows how we compose OpenID4VP with OpenID4VCI in the pre-authorized code flow to issue attestations based on the contents of other attestations.</p>
<p>The flow starts with the user scanning a QR code or tapping a UL that contains the URL to the disclosure based issuer. When the wallet contacts the issuer using this URL, it starts a disclosure session requesting some preconfigured set of attributes that will allow it to determine the attributes that it wants to issue. For example, suppose the issuer wishes to issue academic degrees based on the user’s BSN, then it would preconfigure an Authorization Request that requests the BSN from the PID.</p>
<p>After the user has disclosed the requested attributes, the issuer sends those to an internal endpoint that responds with the attestations to be issued. In the earlier mentioned example, this would be a database containing academic degrees indexed by BSNs.</p>
<p>Finally, the issuer issues the attestations using OpenID4VCI in the pre-authorized code flow.</p>
<p>During OpenID4VCI, the issuer requires the wallet to include the keys of the attestations that it disclosed earlier in its Proof of Association (PoA) when it sends its Proofs of Possession (PoPs) for the keys of the attestation (copies). This enforces that the newly issued attestations are bound to the same WSCD as the one that disclosed the attestations in the first part of the protocol.</p>
<pre  class="mermaid">
        sequenceDiagram
    autonumber
    actor User
    participant App as Wallet
    participant Issuer as Disclosure based issuer
    participant IssuerDataProvider as Data Provider

    User-&gt;&gt;+App: Invoke UL (https://wallet_ul/disclosure_based_issuance)
    App-&gt;&gt;+Issuer: POST to request URI [OpenID4VP]
    Issuer-&gt;&gt;Issuer: Start disclosure session with preconfigured request
    Issuer-&gt;&gt;-App: Authorization Request [OpenID4VP]

    App -&gt;&gt;-User: Request approval for disclosure
    User-&gt;&gt;+ App: Approve disclosure with PIN

    App-&gt;&gt;+Issuer: Authorization Response [OpenID4VP] (including PoA) *
    Issuer-&gt;&gt;Issuer: Verify disclosed attributes
    Issuer-&gt;&gt;+IssuerDataProvider: Disclosed attributes
    IssuerDataProvider-&gt;&gt;-Issuer: Respond with attestations to issue
    Issuer-&gt;&gt;Issuer: Start issuance session
    Issuer-&gt;&gt;Issuer: Create OpenID4VCI Credential Offer (pre-authorized code flow)
    Issuer-&gt;&gt;-App: Redirect URI [OpenID4VP]

    App-&gt;&gt;App: Parse Token Request from Credential Offer
    App-&gt;&gt;+Issuer: Pre-authorized code [OpenID4VCI]
    Issuer-&gt;&gt;-App: Access Token + attestation previews [OpenID4VCI]

    App-&gt;&gt;-User: Request approval for attestations
    User-&gt;&gt;+App: Approve attestation issuance with PIN

    App-&gt;&gt;+Issuer: Access token [OpenID4VCI]
    Issuer-&gt;&gt;Issuer: Enforce disclosed attestation keys in PoA (from Step 7 *)
    Issuer-&gt;&gt;-App: Attestations [OpenID4VCI]
    deactivate App
    </pre></section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="disclosure.html" class="btn btn-neutral float-left" title="Disclosure with OpenID4VP" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="issuance.html" class="btn btn-neutral float-right" title="Issuance with OpenID4VCI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NL Wallet.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.3.0
    <span class="fa fa-caret-down"></span>
  </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Releases</dt>
            <dd><a href="disclosure_based_issuance.html">v0.3.0</a></dd>
            <dd><a href="../../v0.9.1/diagrams/disclosure_based_issuance.html">v0.9.1</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../main/diagrams/disclosure_based_issuance.html">main</a></dd>
        </dl>
    </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>